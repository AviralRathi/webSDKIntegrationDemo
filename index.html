<html>
	<head> 
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<script src="https://hv-camera-web-sg.s3-ap-southeast-1.amazonaws.com/hyperverge-web-sdk@3.3.5/src/sdk.min.js"></script>
	</head>
	<body>
	  <form id="myForm">
		<input type="file" id="csvFile" accept=".csv" />
		<br />
		<input type="submit" value="Submit" />
	  </form>
		<p id="error">Error Count = </p>
		<p id="matchReviewNo"> Match with Review as No = </p>
		<p id="matchReviewYes"> Match with Review as Yes = </p>
		<p id="noMatchReviewYes"> No Match with Review as Yes = </p>
		<p id="noMatchReviewNo"> No Match with Review as No = </p>
		<p id="div1"></p>
	  <script>
		var jwtToken = 'Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcHBJZCI6ImE0NmIxMCIsImhhc2giOiI1MGY4ZjAzNTZiNWI1YzE2ODM2OTE5NzBkYTc0OTIwYzQwYjNiN2I1MjlmN2Q3MWY3MTkzZDdmNzhiMjUxNGMwIiwiaWF0IjoxNjU2MTQyODkxLCJleHAiOjE2NTYxNDg4OTEsImp0aSI6ImI4NzQwZDE3LTMzMTktNDRlZi1hYWI0LTQ0OTg1ZGI0YzNjNyJ9.AwA-MKgoRLsgOQDF7QwUHx7C5BPATYsDtyNvDHgHJ0ASH6REgquPilWNN5N5iDi0KawhfTCNj0P46NhTNGcFPzZeDHULDN6Du5Quy8rC00slK9qnykoB-Z4yLZ0K43hbfD7vXtFp8EFD4oHb2xbP2qu5e69YnsnKIF95j_du83Q'
			HyperSnapSDK.init(jwtToken, HyperSnapParams.Region.India);
			HyperSnapSDK.startUserSession();
			
		const myForm = document.getElementById("myForm");
		const csvFile = document.getElementById("csvFile");
		var y = [];
		var matchReviewYes = 0;
		var matchReviewNo = 0;
		var noMatchReviewYes = 0;
		var noMatchRreviewNo = 0;
		var error = 0;
		function csvToArray(str, delimiter = ",") {

		  // slice from start of text to the first \n index
		  // use split to create an array from string by delimiter
		  const headers = str.slice(0, str.indexOf("\n")).split(delimiter);

		  // slice from \n index + 1 to the end of the text
		  // use split to create an array of each csv value row
		  const rows = str.slice(str.indexOf("\n") + 1).split("\n");

		  // Map the rows
		  // split values from each row into an array
		  // use headers.reduce to create an object
		  // object properties derived from headers:values
		  // the object passed as an element of the array
		  //const arr = 
			rows.map(getValues);
			function getValues(row) {
			const values = row.split(delimiter);
				
				 // callback for faceMatch
					callback = (HVError, HVResponse) => {
					 if (HVError) {
					  //var para = document.createElement('p');
					  //var node = document.createTextNode(JSON.stringify(HVError));
					  //para.appendChild(node);
					  //var element = document.getElementById('div1');
					  //element.appendChild(para);
					  var x = {};
					  x["statusCode"] = HVError.errorCode;
					  x["message"] = HVError.errorMsg;
						error++;
					  
					  y.push(x);
					  document.getElementById("div1").innerHTML = JSON.stringify(y);
						document.getElementById("error").innerHTML = error;
					 } 
				 else {
					  //var para = document.createElement('p');
					  //var node = document.createTextNode(JSON.stringify(HVResponse));
					  //para.appendChild(node);
					  //var element = document.getElementById('div1');
					  //element.appendChild(para);
					var x = {};
					x["statusCode"] = HVResponse.getApiResult().statusCode;
					x["match"] = HVResponse.getApiResult().result.match;
					x["review"] = HVResponse.getApiResult().result['to-be-reviewed'];
					
					y.push(x);
					 if(HVResponse.getApiResult().result.match == "yes" && HVResponse.getApiResult().result['to-be-reviewed'] == "no"){ matchReviewNo++;}
					 else if(HVResponse.getApiResult().result.match == "yes" && HVResponse.getApiResult().result['to-be-reviewed'] == "yes"){ matchReviewYes++;}
					 	else if(HVResponse.getApiResult().result.match == "no" && HVResponse.getApiResult().result['to-be-reviewed'] == "no"){ noMatchReviewNo++;}
					 		else if(HVResponse.getApiResult().result.match == "no" && HVResponse.getApiResult().result['to-be-reviewed'] == "yes"){ noMatchReviewYes++;}
					document.getElementById("div1").innerHTML = JSON.stringify(y);
					 
					 //var para = document.createElement('p');
					  //var node = document.createTextNode(matchReviewYes);
					  //para.appendChild(node);
					  //var element = document.getElementById('matchReviewYes');
					  //element.appendChild(para);
					document.getElementById("matchReviewNo").innerHTML = matchReviewNo;
					 document.getElementById("matchReviewYes").innerHTML = matchReviewYes;
					 document.getElementById("noMatchReviewYes").innerHTML = noMatchReviewYes;
					 document.getElementById("noMatchReviewNo").innerHTML = noMatchReviewNo;
			  }
			};
			const ckycString = values[2] || 'thirteenchars';
			setTimeout(function () {HVNetworkHelper.makeFaceMatchCall(values[3], ckycString.substr(4,ckycString.length-8), {},{}, callback)}, 5000);
			
			//const el = headers.reduce(function (object, header, index) {
			 // object[header] = values[index];
			  //return object;
			//}, {});
			//return el;
		  };

		  // return the array
		  //return arr;
		}

		myForm.addEventListener("submit", function (e) {
		  e.preventDefault();
		  const input = csvFile.files[0];
		  const reader = new FileReader();

		  reader.onload = function (e) {
			const text = e.target.result;
			//const data = 
			csvToArray(text);
			//document.write(JSON.stringify(data));
		  };
		  
		  reader.readAsText(input);
		});
	  </script>
	</body>
</html>
